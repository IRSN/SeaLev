<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="
  
Computes the distribution and return levels for sea levels from the
  two parts &amp;#8216;tidal&amp;#8217; and &amp;#8216;surge&amp;#8217; using a convolution
  method."><title>Convolution for Sea Levels tide and surge — convSL • SeaLev</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convolution for Sea Levels tide and surge — convSL"><meta property="og:description" content="
  
Computes the distribution and return levels for sea levels from the
  two parts &amp;#8216;tidal&amp;#8217; and &amp;#8216;surge&amp;#8217; using a convolution
  method."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SeaLev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4-4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Convolution for Sea Levels tide and surge</h1>
      
      <div class="d-none name"><code>convSL.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    
  
<p>Computes the distribution and return levels for sea levels from the
  two parts ‘tidal’ and ‘surge’ using a convolution
  method.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">convSL</span><span class="op">(</span><span class="va">dens.x</span>,</span>
<span>          shift.x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>          threshold.y <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>          distname.y <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>          shift.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">threshold.y</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">threshold.y</span><span class="op">)</span>,</span>
<span>          par.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rate"</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>          covpar.y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">threshold.y</span><span class="op">)</span>, <span class="fl">705.8</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>          pct.conf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">95</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>          use.covlambda <span class="op">=</span> <span class="st">"lambda"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">covpar.y</span><span class="op">)</span>,</span>
<span>          prob <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          prob.max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">threshold.y</span><span class="op">)</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">1e-8</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">1e-5</span><span class="op">)</span>,</span>
<span>          pred.period <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          N <span class="op">=</span> <span class="fl">2048L</span>,</span>
<span>          N.quad <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          Tlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e+5</span><span class="op">)</span>,</span>
<span>          deriv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          show.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          show.asympt <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          alpha.below <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          trace <span class="op">=</span> <span class="fl">0</span>,</span>
<span>          <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dens.x</dt>
<dd>

<p>List containing the density for the tidal level.  It must contain
    two vectors <code>$x</code> and <code>$y</code> giving points on the density
    curve. The <code>x</code> vector must be sorted in ascending order, and
    the <code>y</code> vector must contain non negative values with end values
    equal to 0 or nearly such. The first and last values in <code>x</code>
    give the lowest and the highest astronomical tides up to the shift
    <code>shift.x</code>.</p>
<p></p></dd>
 
  <dt>shift.x</dt>
<dd>

<p>Numeric constant to add to the total level e.g.  a reference level
    if the density in <code>dens.x</code> has to be shifted. This can be
    useful to change the reference elevation.</p>
<p></p></dd>

  <dt>threshold.y</dt>
<dd>

<p>Threshold used in the surge POT fit. The surge excesses over this
    threshold are assumed to follow a known distribution.</p>
<p></p></dd>

  <dt>distname.y</dt>
<dd>
    
<p>The distribution name for the surge excesses over the threshold. The
    supported distribution names are those of the <code>fRenouv</code> in the
    <code>Renext</code> package. The distribution values are the non-negative
    reals. Most distributions will have one or two parameters: for a gpd
    distribution the, location parameter must be <code>0</code> since it
    applies to excesses.</p>
<p></p></dd>

  <dt>shift.y</dt>
<dd>

<p>Numeric constant having the same dimension as the variable <code>Y</code>,
    and used to shift the distribution. When a POT distribution is used
    this is automatically set to <code>threshold.y</code> and thus the
    distribution is assumed to be for the excesses over the
    threshold. In other cases, it should be normally zero.</p>
<p></p></dd>

  <dt>par.y</dt>
<dd>

<p>Named list or vector containing the values of the
    parameters. Parameters with default values in the corresponding
    densities and distribution functions can be omitted and will be such
    if plugged in from a POT output. For instance the location parameter
    of the gpd will not be given and will take its default value
    <code>0</code>.</p>
<p></p></dd>

  <dt>covpar.y</dt>
<dd>

<p>A covariance matrix for the parameters of the y-part. It can also
    contain a row and column for the event rate <code>lambda</code> (see
    Details). The colnames and rownames must agree and must be equal
    either to <code>names(par.y)</code> or to <code>c("lambda",
    names(par.y))</code>.</p>
<p></p></dd>

  <dt>lambda</dt>
<dd>
    
<p>The event rate in the surge POT. Should be given in <em>events by
    year</em> since the return levels are given on a yearly basis.</p>
<p></p></dd>

  <dt>pct.conf</dt>
<dd>

<p>Confidence levels in percent. Should be given in decreasing order.</p>
<p></p></dd>

  <dt>use.covlambda</dt>
<dd>

<p>Logical indicating if the uncertainty on the event rate
    <code>lambda</code> should be taken into account in the delta method or
    not.</p>
<p></p></dd>

  <dt>prob</dt>
<dd>

<p>Probability for which the return levels are wanted in the
    <code>ret.lev</code> table. A <code>NULL</code> value correspond to a default
    vector of values.</p>
<p></p></dd>

  <dt>prob.max</dt>
<dd>

<p>Maximal probability for the return level table/plot.</p>
<p></p></dd>

  <dt>pred.period</dt>
<dd>

<p>If not <code>NULL</code>, a vector giving periods at which predictions
    (return levels and confidence limits) should be computed and
    returned in the <code>pred</code> data.frame. The results are returned in
    a <code>pred</code> data.frame.</p>
<p></p></dd>

  <dt>N</dt>
<dd>

<p>Number of points in the convolution grid. Should be a power of two
    for a best computation speed.</p>
<p></p></dd>

  <dt>N.quad</dt>
<dd>

<p>Number of quadrature points, corresponding to high return periods.</p>
<p></p></dd>

  <dt>Tlim</dt>
<dd>

<p>Limits for the return periods.</p>    
<p></p></dd>

  <dt>deriv</dt>
<dd>

<p>Logical. If <code>TRUE</code> numerical derivatives are used to compute
    approximate confidence intervals by the delta method.</p>    
<p></p></dd>

  </dl><p><!-- %% \item{quad}{ --></p>
<p></p>
<p><!-- %%   Quadrature rule underlying the convolution. Can --></p>
<p></p>
<p><!-- %%   be \code{"trapmod"} or \code{"trap"}. The differences between --></p>
<p></p>
<p><!-- %%   the two methods seem small in practice. --></p>
<p></p>
<p><!-- %% } --></p>
<dl><dt>plot</dt>
<dd>
    
<p>Logical. Should a return level plot be drawn?</p>    
<p></p></dd>

  <dt>show.x</dt>
<dd>
    
<p>Logical indicating if a "tidal return level" curve should
    be added to the return level plot. See <b>Details</b> below.</p>    
<p></p></dd>

  <dt>show.asympt</dt>
<dd>
    
<p>Logical. When <code>TRUE</code>, a curve showing the asymptotic behavior
    is added to the return level plot. This is available only for the
    exponential or the GPD with positive shape. In the first case, the
    added curve should be close to the curve obtained by convolution. In
    the second case, the added curve should be broadly parallel to the
    convolution curve. The added curve indicates the shape of the curve
    for <em>very large</em> return periods.</p>
<p></p></dd>

  <dt>alpha.below</dt>
<dd>

<p>A value of transparency to (partially) occult the region of the plot
    lying below the minimal level of validity for the convolution, see
    <b>Details</b>. The value <code>0</code> means a fully transparent
    rectangle (no effect), and the value <code>1</code> means a fully opaque
    one. When using a device that do not support transparency, only the
    values <code>0</code> and <code>1</code> will be possible.</p>
<p></p></dd>

  <dt>trace</dt>
<dd>

<p>Integer giving a level of verbosity. The value <code>0</code> leads to
    printing nothing.</p>
<p></p></dd>

  <dt>...</dt>
<dd>

<p>Further arguments to be passed to <code>RSLplot</code> and then to
    <code>plot</code>. Most commonly used are <code>Tlim</code> <code>problim</code> from
    <code>RSLplot</code>, <code>main</code>, <code>ylim</code> from <code>plot</code>.  The
    arguments <code>z</code> an <code>duration</code> can also be used to add
    empirical points to the plot, see the vignette shipped with this
    package for examples.</p>
<p></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
  
<p>The function computes the density and distribution functions for a
  surge \(Z = X +Y\) where \(X\) is a tidal level and
  \(Y\) is a random surge level with given (conditional) distribution
  over the threshold. The tidal level \(X\) has a distribution given
  in <code>dens.x</code>. The two parts \(X\) and \(Y\) are assumed to be
  independent hence the density of \(Z\) can be found using a
  numerical convolution.</p>  
<p>Since the distribution for the surge \(Y\) is given only for
  \(Y &gt; u \) where \(u\) is the threshold, the
  distribution of \(Z\) is known only for \(Z &gt; \textrm{HAT} +
  u\). Therefore <b>only the corresponding part of the
  return level curve must be considered</b>. The left-side part can be
  considered as an extrapolation for small surge levels which is
  unwarranted.</p> 
<p>An approximate inference is derived using the "delta method" and the
  covariance matrix given in <code>covpar.y</code> (if any).  The return level
  \(z(T)\) corresponding to $$z(T) = q_Z(p) \qquad p = 1 -
  \frac{1}{\lambda T}$$ where
  \(q_Z(p)\) is the quantile function of \(Z\).  The
  quantile function is deduced from the distribution function and the
  event rate \(\lambda\) is replaced by its estimation
  provided in the <code>lambda</code> formal.</p>  
<p>Depending on the value of <code>use.covlambda</code> the impact on the
  estimation of \(\lambda\) on the return level will be taken
  into account or not.</p> 
<p>When <code>plot</code> is <code>TRUE</code>, a return level plot is shown using a
  log scale for the return periods. The return level curve will have an
  asymptote for large return periods when the distribution of <code>Y</code>
  is exponential.</p>
<p>When <code>plot</code> and <code>show.x</code> are <code>TRUE</code>, the conditional
  expectation curve is shown. This curve shows the conditional expected
  tidal level $$\textrm{E}[X \vert Z=z]$$ with
  \(z=z(T)\) taken equal to the return level associated to the
  period \(T\). This curve might not be visible and it can be
  necessary to adjust the <code>ylim</code> argument. The curve points out the fact
  that return levels for sea levels are <em>not</em> conditional to the
  tidal level, and therefore that the sea levels corresponding to a
  given tide are much greater than suggested by the return level curve.</p>
<p>It can be shown that when the distribution of surge is exponential
  the conditional expectation is constant for large return periods
  \(T\) and then takes a value &lt; HAT. When the distribution of surge is GPD
  with a positive shape,
  the conditional expectation is increasing but with very slow rate.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    
  

<p>A list with elements</p>
<dl><dt>dens.x, dens.y, dens.z</dt>
<dd>

<p>Density of the tidal level, the surge and the total sea level.</p>
<p></p></dd>

  <dt>dist.x, dist.y, dist.z</dt>
<dd>

<p>Distribution functions as for the densities</p>
<p></p></dd>

  <dt>z, T</dt>
<dd>

<p>Numeric vectors of return levels and return periods. These
    are all the computed values and the values of <code>T</code> do not
    take only 'pretty' values.</p>
<p></p></dd>

  <dt>dSy, dSz, dzz</dt>
<dd>

<p>Matrices with columns giving the derivatives of <code>Sy</code>, <code>Sz</code>
    or <code>z</code> with respect to the parameters taken from
    <code>par.y</code>. For <code>dz</code> an extra column is placed in position
    <code>1</code> containing the derivative with respect to the event rate if
    <code>use.covlambda</code> is <code>TRUE</code>.</p>
<p></p></dd>
 
  <dt>ret.lev</dt>
<dd>

<p>Data.frame containing the return levels for some given or default
    probabilities. It contains columns for the probability, the return
    period, the return level (or quantile) as well as confidence limits
    for the return level. When <code>use.covlambda</code> is <code>TRUE</code> the
    confidence limits should be associated with the return periods (and
    not the probabilities), at least for relatively small probabilities.</p>    
<p></p></dd>

  <dt>pred</dt>
<dd>

<p>Data.frame containing the predicted return levels for some given or
    default return levels.</p>
<p></p></dd>

  <dt>condExp.x</dt>
<dd>

<p>The conditional expectation vector, in correspondence with the grid
    for the density of <code>x</code>.</p>
<p></p></dd>

  <dt>logmomExp</dt>
<dd>

<p>When the distribution of \(Y\) is exponential, the logarithm of
    the exponential moment
    \(\textrm{E}[e^{X/\sigma_Y}]\) where
    \(\sigma_Y\) is the scale parameter of the exponential
    distribution. See the vignette shipped with this package for more
    information.</p>
<p></p></dd>

  <dt>logmomExp</dt>
<dd><p>Character vector</p></dd>

  
</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    
  
<p>D. T. Pugh and J. M. Vassie (1978)
  "Extreme sea-levels from tide and surge probability"
  <em>Proceeding of the 16th Coastal Engineering Conference</em>, Hamburg.</p>  
<p>B. Simon <em>La marée océanique
    côtière</em>.
  Institut océanographique, 2007.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    

<p>Yves Deville</p>
    </div>
    <div class="section level2">
    <h2 id="warnings">Warnings<a class="anchor" aria-label="anchor" href="#warnings"></a></h2>
    

<p>The densities and conditional expectations are given on for a wide
  grid and for very small probability of exceedance
  \(1-F_Z(z)\), say less than <code>1e-4</code>. The numerical
  precision weakens for very small values of \(F_Z(z)\). In
  future versions, the vectors will be truncated at a suitable value. A
  rule for a robust determination (with respect to the distribution of
  surges) still needs some investigations. Yet a minimal probability of
  exceedance about <code>1e-4</code> seems a good indication.</p>  
<p>Some distribution of the surge can have unbounded density,
   e.g. Weibull or gamma. This may affect the precision of the discrete
   approximation used in the numerical convolution.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    
  
<p>When a non-zero value is used for <code>shift.x</code>, the returned density
  for \(X\) is left unchanged, i.e. is not shifted. Only the
  distribution of \(Z\) is shifted. On the contrary when an non-zero
  <code>shift.y</code> is given, the density of \(Y\) is shifted. Thus if
  a POT model is given with threshold \(u\) the distribution
  specified on input is for the excesses \(Y-u\), but the
  <code>dens.y</code> and <code>dist.y</code> objects of the returned list are for
  the \(Y\) levels.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
  
<p><code><a href="RSLplot.html">RSLplot</a></code> for return level plot. The previous version
  <code><a href="convSLOld.html">convSLOld</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This example NEEDS Renext </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Brest</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Brest.tide</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## POT</span></span></span>
<span class="r-in"><span><span class="va">distname.y</span> <span class="op">&lt;-</span> <span class="st">"exponential"</span></span></span>
<span class="r-in"><span><span class="va">fit.exp</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Brest</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Surge</span>,</span></span>
<span class="r-in"><span>         effDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Brest</span><span class="op">$</span><span class="va">OTinfo</span><span class="op">$</span><span class="va">effDuration</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         threshold <span class="op">=</span> <span class="fl">50</span>, distname.y <span class="op">=</span> <span class="va">distname.y</span>,</span></span>
<span class="r-in"><span>         main <span class="op">=</span> <span class="st">"exponential POT for surge"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Special inference for the exponential case without history</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>uncertainty on the rate not taken into account yet  in the exponential with no history case</span>
<span class="r-plt img"><img src="convSL-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plug results into convSL</span></span></span>
<span class="r-in"><span><span class="va">res.exp</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu">convSL</span><span class="op">(</span>dens.x <span class="op">=</span> <span class="va">Brest.tide</span>,</span></span>
<span class="r-in"><span>          threshold.y <span class="op">=</span> <span class="fl">50</span>, distname.y <span class="op">=</span> <span class="va">distname.y</span>,</span></span>
<span class="r-in"><span>          lambda <span class="op">=</span> <span class="va">fit.exp</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"lambda"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>          par.y <span class="op">=</span> <span class="va">fit.exp</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"rate"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>          covpar.y <span class="op">=</span> <span class="va">fit.exp</span><span class="op">$</span><span class="va">cov</span>,</span></span>
<span class="r-in"><span>          use.covlambda <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">"exponential"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="convSL-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## some results </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res.exp</span><span class="op">$</span><span class="va">pred</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       prob period quant L.95 U.95 L.70 U.70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100      1  1e+02   462  459  464  460  463</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 200      1  2e+02   469  466  473  467  471</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 500      1  5e+02   479  474  483  477  481</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1000     1  1e+03   486  481  492  483  489</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2000     1  2e+03   494  487  500  490  497</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3000     1  3e+03   498  491  505  494  502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4000     1  4e+03   501  494  508  497  505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5000     1  5e+03   503  496  511  499  507</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6000     1  6e+03   505  498  513  501  509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7000     1  7e+03   507  499  515  503  511</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8000     1  8e+03   508  500  516  504  513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9000     1  9e+03   510  501  518  505  514</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10000    1  1e+04   511  502  519  506  515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20000    1  2e+04   518  509  527  513  523</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50000    1  5e+04   528  517  538  522  533</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1e+05    1  1e+05   535  524  547  529  541</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1e+06    1  1e+06   560  545  574  552  567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1e+07    1  1e+07   584  566  602  575  593</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res.exp</span><span class="op">$</span><span class="va">dens.z</span>, type <span class="op">=</span><span class="st">"l"</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"density of Z"</span>, xlab <span class="op">=</span> <span class="st">"m"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="convSL-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## POT with gpd with two</span></span></span>
<span class="r-in"><span><span class="va">distname.y</span> <span class="op">&lt;-</span> <span class="st">"gpd"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit.gpd</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Brest</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Surge</span>,</span></span>
<span class="r-in"><span>          effDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Brest</span><span class="op">$</span><span class="va">OTinfo</span><span class="op">$</span><span class="va">effDuration</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          threshold <span class="op">=</span> <span class="fl">50</span>, distname.y <span class="op">=</span> <span class="va">distname.y</span>,</span></span>
<span class="r-in"><span>          main <span class="op">=</span> <span class="st">"gpd POT for surge"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="convSL-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">res.gpd1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu">convSL</span><span class="op">(</span>dens.x <span class="op">=</span> <span class="va">Brest.tide</span>,</span></span>
<span class="r-in"><span>          threshold.y <span class="op">=</span> <span class="fl">50</span>, distname.y <span class="op">=</span> <span class="va">distname.y</span>,</span></span>
<span class="r-in"><span>          lambda <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"lambda"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>          par.y <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">est.y</span>,</span></span>
<span class="r-in"><span>          covpar.y <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">cov</span>,</span></span>
<span class="r-in"><span>          use.covlambda <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>          main <span class="op">=</span> <span class="st">"gpd with uncertainty on \"lambda\""</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>'show.asympt' not yet implemented for GPD with negative shape</span>
<span class="r-plt img"><img src="convSL-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ignore the uncertainty on 'lambda'</span></span></span>
<span class="r-in"><span><span class="va">res.gpd2</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu">convSL</span><span class="op">(</span>dens.x <span class="op">=</span> <span class="va">Brest.tide</span>,</span></span>
<span class="r-in"><span>           threshold.y <span class="op">=</span> <span class="fl">50</span>, distname.y <span class="op">=</span> <span class="va">distname.y</span>,</span></span>
<span class="r-in"><span>           lambda <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"lambda"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           par.y <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">est.y</span>,</span></span>
<span class="r-in"><span>           covpar.y <span class="op">=</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">cov</span>,</span></span>
<span class="r-in"><span>           use.covlambda <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           main <span class="op">=</span> <span class="st">"gpd ignoring uncertainty on \"lambda\""</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>'show.asympt' not yet implemented for GPD with negative shape</span>
<span class="r-plt img"><img src="convSL-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

